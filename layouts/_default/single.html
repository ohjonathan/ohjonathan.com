{{ define "main" }}
<article class="single-page">
  <header class="page-header">
    <h1 class="page-title">{{ .Title }}</h1>
    {{ with .Description }}
    <p class="page-description">{{ . }}</p>
    {{ end }}
    {{ if eq .Section "posts" }}
    <div class="page-meta">
      <time>{{ .Date.Format "January 2, 2006" }}</time>
      {{ with .Params.tags }}
      <span class="meta-separator">·</span>
      {{ range . }}<span class="tag">{{ . }}</span>{{ end }}
      {{ end }}
    </div>
    {{ end }}
  </header>

  {{ $content := .Content }}
  {{ $tocEnabled := ne .Params.toc false }}
  {{ $tocContent := .TableOfContents }}
  {{ $tocItemsCount := len (findRE "(?i)<li\\b[^>]*>" $tocContent) }}
    {{ $showTOC := and $tocEnabled (ge $tocItemsCount 3) }}

    {{ if $showTOC }}
    <details class="page-toc">
      <summary class="page-toc-summary">On this page</summary>
      <div class="page-toc-body">{{ $tocContent }}</div>
    </details>
    {{ end }}

    <div class="page-content">
      {{ $content }}
    </div>
    {{ if eq .Section "posts" }}
    <nav class="post-nav">
      {{ with .PrevInSection }}
      <a href="{{ .Permalink }}" class="post-nav-link prev">← {{ .Title }}</a>
      {{ end }}
      {{ with .NextInSection }}
      <a href="{{ .Permalink }}" class="post-nav-link next">{{ .Title }} →</a>
      {{ end }}
    </nav>
    {{ end }}
</article>
{{ end }}